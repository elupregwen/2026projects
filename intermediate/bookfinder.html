<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aklat at Pluma | Discover Free Literature</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        moss: {
                            50: '#f5f7f0',
                            100: '#e9edd8',
                            200: '#d4deba',
                            300: '#b7c992',
                            400: '#9ab26c',
                            500: '#7f9752', // Deep moss green
                            600: '#627841',
                            700: '#4c5e34',
                            800: '#3f4c2e',
                            900: '#364029',
                        },
                        ivory: '#fcf9f2',
                        gold: {
                            50: '#fdfce9',
                            100: '#faf7c9',
                            200: '#f5ee96',
                            300: '#eee059', // Soft antique gold
                            400: '#e3cf2f',
                            500: '#d3b91f',
                            600: '#b59316',
                            700: '#906c15',
                            800: '#785718',
                            900: '#66481b',
                        },
                        lavender: {
                            50: '#f9f8fb',
                            100: '#f1eff7',
                            200: '#e5e1f0',
                            300: '#d2cbe5', // Lavender-gray
                            400: '#b8aed6',
                            500: '#9f91c7',
                            600: '#8775b8',
                            700: '#7260a5',
                            800: '#5f5189',
                            900: '#4e446f',
                        }
                    },
                    fontFamily: {
                        'serif': ['Cormorant Garamond', 'Georgia', 'serif'],
                        'sans': ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.8s ease-out',
                        'float': 'float 6s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-10px)' },
                        },
                        glow: {
                            '0%': { 'text-shadow': '0 0 5px rgba(226, 224, 89, 0.3)' },
                            '100%': { 'text-shadow': '0 0 20px rgba(226, 224, 89, 0.6)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- Custom Styles -->
    <style>
        body {
            background-color: #fcf9f2;
        }

        .page-transition {
            animation: fadeIn 0.8s ease-out;
        }

        .book-card {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .book-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(127, 151, 82, 0.15);
        }

        .book-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #e2e059, #7f9752);
            transform: scaleX(0);
            transition: transform 0.4s ease;
            transform-origin: left;
        }

        .book-card:hover::before {
            transform: scaleX(1);
        }

        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(127, 151, 82, 0.2);
            border-color: #7f9752;
        }

        .filter-btn.active {
            background-color: #7f9752;
            color: #fcf9f2;
            box-shadow: 0 4px 12px rgba(127, 151, 82, 0.3);
        }

        .source-card {
            transition: all 0.3s ease;
            border: 1px solid #e9e5d7;
        }

        .source-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(127, 151, 82, 0.1);
            border-color: #7f9752;
        }

        .ornamental-divider {
            position: relative;
            text-align: center;
            margin: 2rem 0;
        }

        .ornamental-divider::before {
            content: "‚ùñ";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fcf9f2;
            padding: 0 1rem;
            color: #e2e059;
            font-size: 1.2rem;
        }

        .ornamental-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, #d2cbe5, transparent);
            z-index: -1;
        }

        .fairy-sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background-color: #e2e059;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
        }

        @keyframes sparkle {
            0% {
                opacity: 0;
                transform: scale(0);
            }

            50% {
                opacity: 1;
                transform: scale(1);
            }

            100% {
                opacity: 0;
                transform: scale(0);
            }
        }

        .header-ornament {
            position: relative;
            display: inline-block;
        }

        .header-ornament::after {
            content: '‚úß';
            position: absolute;
            top: -10px;
            right: -20px;
            color: #e2e059;
            font-size: 1.2rem;
            animation: glow 2s ease-in-out infinite alternate;
        }

        .leaf-accent {
            position: relative;
        }

        .leaf-accent::before {
            content: 'üçÉ';
            position: absolute;
            left: -25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1rem;
            color: #7f9752;
        }
    </style>
</head>

<body class="font-sans text-gray-800">
    <!-- Navigation -->
    <nav class="bg-moss-900/95 backdrop-blur-sm sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="relative">
                        <i class="fas fa-feather-alt text-gold-300 text-2xl"></i>
                        <div class="absolute -top-1 -right-1 w-2 h-2 bg-gold-300 rounded-full animate-pulse"></div>
                    </div>
                    <div>
                        <h1 class="text-2xl font-serif font-bold text-ivory">Aklat at Pluma</h1>
                        <p class="text-xs text-moss-300 font-serif italic">books & quill</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#" class="text-ivory/80 hover:text-gold-300 transition-colors font-serif">Discover</a>
                    <a href="#" class="text-ivory/80 hover:text-gold-300 transition-colors font-serif">Classics</a>
                    <a href="#" class="text-ivory/80 hover:text-gold-300 transition-colors font-serif">About</a>
                    <button
                        class="bg-gold-300 text-moss-900 px-4 py-2 rounded-full text-sm font-medium hover:bg-gold-400 transition-colors">
                        <i class="fas fa-book-open mr-2"></i> Start Reading
                    </button>
                </div>
                <button class="md:hidden text-ivory">
                    <i class="fas fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative overflow-hidden">
        <!-- Background Pattern -->
        <div class="absolute inset-0 opacity-5">
            <div class="absolute top-10 left-10 text-6xl">‚ùñ</div>
            <div class="absolute bottom-20 right-20 text-6xl">‚úß</div>
            <div class="absolute top-1/3 right-1/4 text-4xl">üçÉ</div>
        </div>

        <div class="container mx-auto px-4 py-16 md:py-24 relative">
            <div class="max-w-3xl mx-auto text-center">
                <div class="header-ornament inline-block mb-6">
                    <h1 class="text-4xl md:text-5xl font-serif font-bold text-moss-800 mb-4">
                        Discover Timeless Literature
                    </h1>
                </div>

                <p class="text-lg md:text-xl text-moss-600 mb-8 font-serif italic">
                    Where Filipino heritage meets the written word. A curated sanctuary for free literature.
                </p>

                <!-- Search Box -->
                <div
                    class="bg-white/80 backdrop-blur-sm rounded-2xl p-2 shadow-xl max-w-2xl mx-auto border border-moss-200">
                    <div class="flex flex-col md:flex-row">
                        <div class="flex-grow relative">
                            <i
                                class="fas fa-search absolute left-5 top-1/2 transform -translate-y-1/2 text-moss-400"></i>
                            <input type="text" id="searchInput" placeholder="Search by title, author, or keyword..."
                                class="w-full pl-12 pr-4 py-5 text-moss-900 bg-transparent search-input rounded-l-2xl focus:outline-none placeholder-moss-400 font-serif">
                        </div>
                        <button id="searchBtn"
                            class="bg-moss-600 text-ivory font-serif font-semibold py-5 px-8 rounded-r-2xl hover:bg-moss-700 transition-all duration-300 mt-2 md:mt-0 group">
                            <i class="fas fa-magnifying-glass mr-2 group-hover:rotate-12 transition-transform"></i>
                            Search Libraries
                        </button>
                    </div>
                    <div class="text-xs text-moss-500 mt-3 px-4">
                        <i class="fas fa-leaf text-moss-500 mr-1"></i>
                        Searching: Open Library ‚Ä¢ Google Books ‚Ä¢ Project Gutenberg
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8 page-transition">
        <!-- Search Results Header -->
        <div class="mb-12">
            <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8">
                <div class="leaf-accent mb-4 md:mb-0">
                    <h2 class="text-3xl font-serif font-bold text-moss-800">Search Results</h2>
                </div>
                <div id="resultCount" class="text-moss-600 text-lg font-medium font-serif">
                    <span class="text-gold-600">0</span> books found
                </div>
            </div>

            <div class="flex flex-wrap gap-3 mb-8">
                <button
                    class="filter-btn active bg-moss-600 text-ivory px-5 py-2.5 rounded-full text-sm font-medium transition-all duration-300"
                    data-filter="all">
                    <i class="fas fa-star mr-2"></i> All Books
                </button>
                <button
                    class="filter-btn bg-white text-moss-700 border border-moss-200 px-5 py-2.5 rounded-full text-sm font-medium hover:border-moss-400 hover:text-moss-800 transition-all duration-300"
                    data-filter="fiction">
                    <i class="fas fa-crown mr-2"></i> Fiction
                </button>
                <button
                    class="filter-btn bg-white text-moss-700 border border-moss-200 px-5 py-2.5 rounded-full text-sm font-medium hover:border-moss-400 hover:text-moss-800 transition-all duration-300"
                    data-filter="nonfiction">
                    <i class="fas fa-scroll mr-2"></i> Non-Fiction
                </button>
                <button
                    class="filter-btn bg-white text-moss-700 border border-moss-200 px-5 py-2.5 rounded-full text-sm font-medium hover:border-moss-400 hover:text-moss-800 transition-all duration-300"
                    data-filter="classics">
                    <i class="fas fa-landmark mr-2"></i> Classics
                </button>
                <button
                    class="filter-btn bg-white text-moss-700 border border-moss-200 px-5 py-2.5 rounded-full text-sm font-medium hover:border-moss-400 hover:text-moss-800 transition-all duration-300"
                    data-filter="poetry">
                    <i class="fas fa-feather mr-2"></i> Poetry
                </button>
            </div>
        </div>

        <!-- Loading State -->
        <div id="loadingState" class="hidden text-center py-20">
            <div class="inline-block animate-spin text-5xl text-gold-400 mb-6">
                <i class="fas fa-feather-alt"></i>
            </div>
            <p class="text-moss-600 font-serif text-lg">Gathering books from timeless libraries...</p>
            <p class="text-moss-400 text-sm mt-2">Open Library ‚Ä¢ Google Books ‚Ä¢ Project Gutenberg</p>
        </div>

        <!-- No Results State -->
        <div id="noResults" class="hidden text-center py-20">
            <div class="inline-block animate-float mb-6">
                <i class="fas fa-book-open text-6xl text-moss-300"></i>
            </div>
            <h3 class="text-2xl font-serif font-bold text-moss-700 mb-3">No books found</h3>
            <p class="text-moss-600 max-w-md mx-auto mb-6">
                Try searching for classics, authors, or literary topics. Our collection focuses on public domain works.
            </p>
            <div id="externalSearchBtns" class="mt-8 flex flex-wrap gap-3 justify-center"></div>
        </div>

        <!-- Results Grid -->
        <div id="resultsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
            <!-- Book cards will be dynamically inserted here -->
        </div>

        <!-- Ornamental Divider -->
        <div class="ornamental-divider my-16">
            <span class="text-moss-400 font-serif text-sm tracking-widest">TRUSTED SOURCES</span>
        </div>

        <!-- Trusted Sources Section -->
        <div class="mb-20">
            <h2 class="text-3xl font-serif font-bold text-center text-moss-800 mb-12">
                Ethically Sourced Literature
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Source 1: Open Library -->
                <div class="source-card bg-white rounded-2xl p-8">
                    <div class="flex items-start mb-6">
                        <div
                            class="bg-moss-50 w-14 h-14 rounded-xl flex items-center justify-center mr-5 border border-moss-200">
                            <i class="fas fa-university text-moss-600 text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-serif font-bold text-xl text-moss-800 mb-2">Open Library</h3>
                            <p class="text-moss-600 text-sm">An open, editable library catalog</p>
                        </div>
                    </div>
                    <p class="text-moss-500 text-sm mb-6">
                        Free digital access to millions of books. Part of the Internet Archive's open-source initiative.
                    </p>
                    <a href="https://openlibrary.org/" target="_blank"
                        class="inline-flex items-center text-moss-600 hover:text-moss-800 text-sm font-medium border border-moss-300 hover:border-moss-500 px-4 py-2 rounded-full transition-all">
                        <i class="fas fa-external-link-alt mr-2 text-xs"></i> Visit Source
                    </a>
                </div>

                <!-- Source 2: Google Books -->
                <div class="source-card bg-white rounded-2xl p-8">
                    <div class="flex items-start mb-6">
                        <div
                            class="bg-lavender-50 w-14 h-14 rounded-xl flex items-center justify-center mr-5 border border-lavender-300">
                            <i class="fab fa-google text-lavender-600 text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-serif font-bold text-xl text-moss-800 mb-2">Google Books</h3>
                            <p class="text-moss-600 text-sm">Preview & access digitized books</p>
                        </div>
                    </div>
                    <p class="text-moss-500 text-sm mb-6">
                        Comprehensive book search with previews and links to full texts where available for free.
                    </p>
                    <a href="https://books.google.com/" target="_blank"
                        class="inline-flex items-center text-moss-600 hover:text-moss-800 text-sm font-medium border border-moss-300 hover:border-moss-500 px-4 py-2 rounded-full transition-all">
                        <i class="fas fa-external-link-alt mr-2 text-xs"></i> Visit Source
                    </a>
                </div>

                <!-- Source 3: Project Gutenberg -->
                <div class="source-card bg-white rounded-2xl p-8">
                    <div class="flex items-start mb-6">
                        <div
                            class="bg-gold-50 w-14 h-14 rounded-xl flex items-center justify-center mr-5 border border-gold-200">
                            <i class="fas fa-book-medical text-gold-600 text-2xl"></i>
                        </div>
                        <div>
                            <h3 class="font-serif font-bold text-xl text-moss-800 mb-2">Project Gutenberg</h3>
                            <p class="text-moss-600 text-sm">60,000+ free public domain ebooks</p>
                        </div>
                    </div>
                    <p class="text-moss-500 text-sm mb-6">
                        The oldest digital library offering free eBooks. Focuses on cultural works in the public domain.
                    </p>
                    <a href="https://www.gutenberg.org/" target="_blank"
                        class="inline-flex items-center text-moss-600 hover:text-moss-800 text-sm font-medium border border-moss-300 hover:border-moss-500 px-4 py-2 rounded-full transition-all">
                        <i class="fas fa-external-link-alt mr-2 text-xs"></i> Visit Source
                    </a>
                </div>
            </div>

            <div class="text-center mt-12 p-6 bg-moss-50/50 rounded-2xl border border-moss-200">
                <div class="flex items-center justify-center mb-3">
                    <i class="fas fa-scale-balanced text-moss-500 mr-3"></i>
                    <h4 class="font-serif font-bold text-moss-700">Ethical & Transparent</h4>
                </div>
                <p class="text-moss-600 text-sm max-w-2xl mx-auto">
                    Aklat at Pluma only uses official, public APIs. We do not scrape websites or host copyrighted
                    material.
                    All book rights belong to their respective authors and publishers.
                </p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-moss-900 text-ivory py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div>
                    <div class="flex items-center mb-4">
                        <i class="fas fa-feather-alt text-gold-300 text-2xl mr-3"></i>
                        <h3 class="text-2xl font-serif font-bold">Aklat at Pluma</h3>
                    </div>
                    <p class="text-moss-300 text-sm mb-4 font-serif italic">
                        "Books and quill" ‚Äî a sanctuary for literature lovers
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-moss-300 hover:text-gold-300"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-moss-300 hover:text-gold-300"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-moss-300 hover:text-gold-300"><i class="fab fa-goodreads"></i></a>
                    </div>
                </div>

                <div>
                    <h4 class="font-serif font-bold text-lg mb-4">Literary Collections</h4>
                    <ul class="space-y-2 text-moss-300">
                        <li><a href="#" class="hover:text-gold-300 transition-colors">Filipino Literature</a></li>
                        <li><a href="#" class="hover:text-gold-300 transition-colors">Public Domain Classics</a></li>
                        <li><a href="#" class="hover:text-gold-300 transition-colors">Poetry Collections</a></li>
                        <li><a href="#" class="hover:text-gold-300 transition-colors">Academic Texts</a></li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-serif font-bold text-lg mb-4">About Our Mission</h4>
                    <p class="text-moss-300 text-sm mb-4">
                        We believe literature should be accessible to all. Aklat at Pluma provides a beautiful, ethical
                        gateway to free books.
                    </p>
                </div>
            </div>

            <div class="border-t border-moss-800 pt-8 text-center">
                <div class="mb-4 p-4 bg-moss-800/50 rounded-xl">
                    <p class="text-moss-300 text-sm italic">
                        <i class="fas fa-info-circle text-gold-300 mr-2"></i>
                        <strong>Disclaimer:</strong> Aklat at Pluma does not host, own, or distribute any books. All
                        book data is sourced from publicly available APIs such as Open Library, Google Books, and
                        Project Gutenberg. External websites are linked for reference only. All rights to books and
                        content belong to their respective authors, publishers, and platforms.
                    </p>
                </div>
                <p class="text-moss-400 text-sm">
                    &copy; 2024 Aklat at Pluma. Made with <i class="fas fa-heart text-gold-300 mx-1"></i> for literature
                    lovers.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Book Sources Data
        // Mark `searchable: true` for sources the backend actually queries
        const sources = [
            { name: "Anna's Archive", url: "https://annas-archive.org/", description: "Open-source search engine indexing shadow libraries", color: "bg-pink-100", textColor: "text-pink-550", searchable: false },
            { name: "Z Library", url: "https://z-lib.id/", description: "Millions of scholarly articles and books", color: "bg-purple-100", textColor: "text-purple-550", searchable: false },
            { name: "Google Books", url: "https://books.google.com/", description: "Preview and access digitized books", color: "bg-blue-100", textColor: "text-blue-600", searchable: true },
            { name: "ManyBooks", url: "https://manybooks.net/", description: "Free and discounted ebooks", color: "bg-green-100", textColor: "text-green-600", searchable: false },
            { name: "Open Library", url: "https://openlibrary.org/", description: "Editable online library catalog", color: "bg-yellow-100", textColor: "text-yellow-600", searchable: true },
            { name: "Smashwords", url: "https://www.smashwords.com/", description: "Independent authors & publishers", color: "bg-red-100", textColor: "text-red-600", searchable: false },
            { name: "DigiLibraries", url: "https://digilibraries.com/", description: "Public domain ebooks collection", color: "bg-indigo-100", textColor: "text-indigo-600", searchable: false },
            { name: "Free-eBooks", url: "https://www.free-ebooks.net/", description: "Free ebooks in multiple categories", color: "bg-teal-100", textColor: "text-teal-600", searchable: false },
            { name: "PDF Drive", url: "https://welib.org/", description: "Search engine for PDF books", color: "bg-orange-100", textColor: "text-orange-600", searchable: false },
            { name: "Project Gutenberg", url: "https://www.gutenberg.org/", description: "60,000+ free public domain ebooks", color: "bg-gray-100", textColor: "text-gray-700", searchable: true }
        ];

        // DOM Elements
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const resultsGrid = document.getElementById('resultsGrid');
        const loadingState = document.getElementById('loadingState');
        const noResults = document.getElementById('noResults');
        const resultCount = document.getElementById('resultCount');
        const sourcesGrid = document.getElementById('sourcesGrid');
        const searchSourcesNote = document.getElementById('searchSourcesNote');
        const externalSearchBtns = document.getElementById('externalSearchBtns');

        // State Variables
        let currentFilter = 'all';
        let currentSearch = '';
        let displayedBooks = [];
        const API_BASE = ''; // when deployed to Vercel the serverless function is at /api/search

        function showLoading(show) {
            if (show) {
                loadingState.classList.remove('hidden');
            } else {
                loadingState.classList.add('hidden');
            }
        }

        async function performRemoteSearch(title, author, requestedLimit = 20) {
            if (!title) return [];
            showLoading(true);
            try {
                const q = `${API_BASE}/api/search?title=${encodeURIComponent(title)}${author ? `&author=${encodeURIComponent(author)}` : ''}&limit=${requestedLimit}`;
                const resp = await fetch(q);
                const data = await resp.json();
                showLoading(false);
                return data;
            } catch (err) {
                showLoading(false);
                return [{ source: 'Local', error: err.toString() }];
            }
        }

        function renderRemoteResults(results) {
            resultsGrid.innerHTML = '';

            if (!results || results.length === 0) {
                noResults.classList.remove('hidden');
                resultCount.textContent = '0 books found';
                renderExternalSearchButtons(currentSearch);
                return;
            }

            // hide external buttons when we have results
            if (externalSearchBtns) externalSearchBtns.innerHTML = '';

            noResults.classList.add('hidden');

            results.forEach(r => {
                if (r.error) {
                    const errDiv = document.createElement('div');
                    errDiv.className = 'col-span-1 p-6 bg-red-50 rounded-lg';
                    errDiv.textContent = `[${r.source || 'Error'}] ${r.error}`;
                    resultsGrid.appendChild(errDiv);
                    return;
                }

                const title = r.title || '(no title)';
                const authors = (r.authors || []).join(', ');
                const link = r.link || '#';
                const source = r.source || 'Unknown';
                const avail = r.availability || '';

                const bookCard = document.createElement('div');
                bookCard.className = 'book-card bg-white rounded-xl overflow-hidden fade-in p-4';
                bookCard.innerHTML = `
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-dark mb-1">${title}</h3>
                        <p class="text-gray-600 text-sm mb-2">${authors}</p>
                        <p class="text-sm text-gray-500 mb-3">Source: <strong>${source}</strong> ${avail ? `‚Ä¢ ${avail}` : ''}</p>
                        <div class="flex gap-2">
                            <a href="${link}" target="_blank" class="bg-primary text-white px-3 py-2 rounded-md text-sm">Open Link</a>
                            <a href="#" class="bg-white border border-gray-200 text-dark px-3 py-2 rounded-md text-sm">View Details</a>
                        </div>
                    </div>
                `;

                resultsGrid.appendChild(bookCard);
            });

            resultCount.textContent = `${results.length} result${results.length !== 1 ? 's' : ''} found`;
        }

        // Event Listeners (remote search)
        searchBtn.addEventListener('click', async () => {
            currentSearch = searchInput.value.trim();
            if (!currentSearch) return;
            const results = await performRemoteSearch(currentSearch);
            renderRemoteResults(results);
        });

        searchInput.addEventListener('keyup', async (event) => {
            if (event.key === 'Enter') {
                currentSearch = searchInput.value.trim();
                if (!currentSearch) return;
                const results = await performRemoteSearch(currentSearch);
                renderRemoteResults(results);
            }
        });

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                filterBtns.forEach(b => {
                    b.classList.remove('active', 'bg-primary', 'text-white', 'border-primary');
                    b.classList.add('bg-white', 'text-dark', 'border-gray-300');
                });

                btn.classList.add('active', 'bg-primary', 'text-white');
                btn.classList.remove('bg-white', 'text-dark', 'border-gray-300');

                currentFilter = btn.getAttribute('data-filter');
            });
        });

        // Render sources section dynamically
        function renderSources() {
            if (!sourcesGrid) return;
            sourcesGrid.innerHTML = '';
            const searchableNames = [];
            sources.forEach(s => {
                if (s.searchable) searchableNames.push(s.name);

                const card = document.createElement('div');
                card.className = 'source-card bg-white rounded-xl p-6';
                card.innerHTML = `
                    <div class="flex items-start mb-4">
                        <div class="${s.color} w-12 h-12 rounded-lg flex items-center justify-center mr-4">
                            <i class="fas fa-book text-2xl ${s.textColor}"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg text-dark">${s.name}</h3>
                            <p class="text-sm text-gray-600 mt-1">${s.description}</p>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <a href="${s.url}" target="_blank" class="inline-flex items-center text-primary hover:text-pink-550 text-sm font-medium">
                            Visit Source <i class="fas fa-external-link-alt ml-2 text-xs"></i>
                        </a>
                        ${s.searchable ?
                        '<span class="px-3 py-1 rounded-full bg-green-50 text-green-700 text-xs font-semibold">Searched</span>' :
                        '<span class="px-3 py-1 rounded-full bg-gray-50 text-gray-600 text-xs">External</span>'}
                    </div>
                `;
                // If not searchable, add a direct-search hint link
                if (!s.searchable) {
                    const hint = document.createElement('div');
                    hint.className = 'mt-3 text-sm';
                    hint.innerHTML = `<a href="${s.url}" target="_blank" class="text-primary underline">Search directly on ${s.name}</a>`;
                    card.appendChild(hint);
                }

                sourcesGrid.appendChild(card);
            });

            if (searchSourcesNote) {
                if (searchableNames.length) {
                    searchSourcesNote.innerHTML = `This search queries: <strong>${searchableNames.join(', ')}</strong>. For other sources below, you can visit them directly.`;
                } else {
                    searchSourcesNote.innerHTML = `This tool currently does not query external sources. Use the links below to search directly on those sites.`;
                }
            }
        }

        // External search helper
        const externalSites = [
            { name: "Anna's Archive", domain: 'annas-archive.org' },
            { name: 'Z Library', domain: 'z-lib.id' },
            { name: 'ManyBooks', domain: 'manybooks.net' },
            { name: 'Smashwords', domain: 'smashwords.com' },
            { name: 'DigiLibraries', domain: 'digilibraries.com' },
            { name: 'Free-eBooks', domain: 'free-ebooks.net' },
            { name: 'PDF Drive', domain: 'pdfdrive.com' }
        ];

        function buildSiteSearchUrl(domain, query) {
            // Use a site-specific Google search to reliably find results on various domains
            const q = `site:${domain} ${query}`;
            return `https://www.google.com/search?q=${encodeURIComponent(q)}`;
        }

        function renderExternalSearchButtons(query) {
            if (!externalSearchBtns) return;
            externalSearchBtns.innerHTML = '';
            if (!query) return;

            // Individual buttons
            externalSites.forEach(s => {
                const a = document.createElement('a');
                a.href = buildSiteSearchUrl(s.domain, query);
                a.target = '_blank';
                a.rel = 'noopener noreferrer';
                a.className = 'bg-white border border-gray-200 text-dark px-4 py-2 rounded-full text-sm hover:bg-gray-50';
                a.textContent = `Search ${s.name}`;
                externalSearchBtns.appendChild(a);
            });

            // Combined search across all external sites
            const combined = externalSites.map(s => `site:${s.domain}`).join(' OR ');
            const combinedUrl = `https://www.google.com/search?q=${encodeURIComponent(combined + ' ' + query)}`;
            const allBtn = document.createElement('a');
            allBtn.href = combinedUrl;
            allBtn.target = '_blank';
            allBtn.rel = 'noopener noreferrer';
            allBtn.className = 'bg-primary text-white px-4 py-2 rounded-full text-sm ml-2';
            allBtn.textContent = 'Search all external sources';
            externalSearchBtns.appendChild(allBtn);
        }

        // Initialize
        function init() {
            renderSources();

            // placeholder animation
            const placeholders = [
                "Search for '1984 by George Orwell'...",
                "Search for 'Pride and Prejudice'...",
                "Search for 'science fiction books'...",
                "Search for 'academic journals'..."
            ];
            let placeholderIndex = 0;

            setInterval(() => {
                if (!document.activeElement || document.activeElement.id !== 'searchInput') {
                    searchInput.placeholder = placeholders[placeholderIndex];
                    placeholderIndex = (placeholderIndex + 1) % placeholders.length;
                }
            }, 3000);
        }

        // Start the application
        init();
    </script>
</body>

</html>