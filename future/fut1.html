<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üå∏ Hand Gesture Magic ‚ú®</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B9D',
                        secondary: '#FF9EBD',
                        accent: '#FFB3C6',
                        pink: {
                            100: '#FFF0F5',
                            200: '#FFE1EB',
                            300: '#FFC2D6',
                            350: '#FF9EBD',
                            400: '#FF85AB',
                            450: '#FF6B9D',
                            500: '#FF5294',
                            550: '#FF4785',
                            600: '#FF3D76',
                            650: '#FF2D6D'
                        }
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s ease-in-out infinite',
                        'bounce-slow': 'bounce 2s infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'sparkle': 'sparkle 2s ease-in-out infinite',
                        'heartbeat': 'heartbeat 1.5s ease-in-out infinite',
                        'glow': 'glow 2s ease-in-out infinite',
                        'slide-up': 'slideUp 0.5s ease-out',
                        'fade-in': 'fadeIn 0.8s ease-out'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-20px)' },
                        },
                        sparkle: {
                            '0%, 100%': { opacity: 1, transform: 'scale(1)' },
                            '50%': { opacity: 0.5, transform: 'scale(1.2)' },
                        },
                        heartbeat: {
                            '0%, 100%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(1.1)' },
                        },
                        glow: {
                            '0%, 100%': { opacity: 1 },
                            '50%': { opacity: 0.7 }
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: 0 },
                            '100%': { transform: 'translateY(0)', opacity: 1 }
                        },
                        fadeIn: {
                            '0%': { opacity: 0 },
                            '100%': { opacity: 1 }
                        }
                    }
                }
            }
        }
    </script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, 
                #FFF0F5 0%, 
                #FFE1EB 25%, 
                #FFC2D6 50%, 
                #FF9EBD 75%, 
                #FF6B9D 100%);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            min-height: 100vh;
            overflow: hidden;
        }

        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Full-screen effects */
        .effect-circle {
            position: fixed;
            border-radius: 50%;
            pointer-events: none;
            z-index: 1000;
            animation: pulse 0.8s ease-out forwards;
        }

        .sparkle {
            position: fixed;
            pointer-events: none;
            z-index: 1001;
            animation: sparkle 2s ease-in-out infinite;
        }

        .heart {
            position: fixed;
            pointer-events: none;
            z-index: 1002;
            animation: heartbeat 1.5s ease-in-out infinite;
        }

        .firework {
            position: fixed;
            pointer-events: none;
            z-index: 1003;
        }

        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            pointer-events: none;
            z-index: 1004;
        }

        @keyframes pulse {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(3);
                opacity: 0;
            }
        }

        /* Glass morphism */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            box-shadow: 0 8px 32px rgba(255, 107, 157, 0.1);
        }

        .glass-dark {
            background: rgba(255, 107, 157, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(255, 107, 157, 0.15);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 182, 193, 0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #FF6B9D, #FF9EBD);
            border-radius: 10px;
        }

        /* Glow effects */
        .glow-pink {
            box-shadow: 0 0 30px rgba(255, 107, 157, 0.3),
                        inset 0 0 20px rgba(255, 255, 255, 0.2);
        }

        /* Hidden video */
        #videoInput {
            position: absolute !important;
            width: 1px !important;
            height: 1px !important;
            opacity: 0 !important;
            pointer-events: none !important;
        }

        /* Smooth transitions */
        .transition-all {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Canvas styling */
        #canvasOutput {
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(255, 107, 157, 0.25);
        }

        /* Floating elements */
        .floating {
            animation: float 6s ease-in-out infinite;
        }
    </style>
</head>
<body class="text-gray-800 overflow-hidden">
    <!-- Visual Effects Container -->
    <div id="visualEffects" class="fixed inset-0 pointer-events-none z-40"></div>

    <!-- Floating Hearts Background -->
    <div class="fixed inset-0 pointer-events-none z-30">
        <div class="absolute top-10 left-10 heart text-3xl text-pink-400 opacity-30">‚ù§Ô∏è</div>
        <div class="absolute top-20 right-20 heart text-2xl text-pink-300 opacity-30">‚ú®</div>
        <div class="absolute bottom-20 left-1/4 heart text-4xl text-pink-500 opacity-30">üå∏</div>
        <div class="absolute bottom-10 right-1/3 heart text-3xl text-pink-450 opacity-30">üíñ</div>
    </div>

    <div class="h-screen p-4 lg:p-8 flex flex-col">
        <!-- Header -->
        <div class="flex justify-between items-center mb-6 lg:mb-8">
            <div class="glass rounded-2xl px-6 py-3 glow-pink animate-slide-up">
                <h1 class="text-2xl lg:text-3xl font-bold bg-gradient-to-r from-pink-600 via-pink-500 to-pink-400 bg-clip-text text-transparent">
                    <i class="fas fa-magic mr-2"></i>
                    Hand Gesture Magic
                    <i class="fas fa-sparkles ml-2"></i>
                </h1>
            </div>
            
            <!-- FPS Meter -->
            <div class="glass rounded-2xl px-4 py-2 glow-pink animate-slide-up">
                <span class="text-sm font-semibold text-pink-600">
                    <i class="fas fa-tachometer-alt mr-1"></i>
                    FPS: <span id="fps" class="text-pink-500 font-bold">0</span>
                    <span class="mx-2">‚Ä¢</span>
                    <i class="fas fa-clock mr-1"></i>
                    <span id="latency" class="text-pink-500 font-bold">0</span>ms
                </span>
            </div>
        </div>

        <!-- Main Content -->
        <div class="flex-1 grid grid-cols-1 lg:grid-cols-4 gap-6 lg:gap-8">
            <!-- Left Column - Camera Output (3/4) -->
            <div class="lg:col-span-3 flex flex-col">
                <div class="glass-dark rounded-3xl p-5 lg:p-6 flex-1 flex flex-col">
                    <div class="flex items-center mb-4 lg:mb-6">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-pink-600 flex items-center justify-center mr-3 shadow-lg">
                            <i class="fas fa-camera text-white text-lg"></i>
                        </div>
                        <div>
                            <h2 class="text-xl lg:text-2xl font-bold text-white">Magic Camera ‚ú®</h2>
                            <p class="text-pink-200 text-sm">Real-time hand tracking with effects</p>
                        </div>
                    </div>
                    
                    <!-- Camera Output - Larger -->
                    <div class="flex-1 relative rounded-2xl overflow-hidden bg-gradient-to-br from-pink-100/20 to-pink-300/20 border-2 border-white/30">
                        <canvas id="canvasOutput" class="w-full h-full object-cover" width="1280" height="720"></canvas>
                        <video id="videoInput" autoplay playsinline muted></video>
                        
                        <!-- Live indicator -->
                        <div class="absolute top-4 right-4">
                            <div class="glass px-3 py-1 rounded-full flex items-center">
                                <div class="w-2 h-2 rounded-full bg-red-400 animate-pulse mr-2"></div>
                                <span class="text-xs text-white font-medium">LIVE</span>
                            </div>
                        </div>
                        
                        <!-- Instructions -->
                        <div class="absolute bottom-4 left-4 right-4 glass rounded-xl p-3">
                            <div class="flex items-center justify-between">
                                <div class="text-white text-sm">
                                    <i class="fas fa-hand-point-right mr-2"></i>
                                    Wave your hand to start the magic!
                                </div>
                                <div id="gestureDisplay" class="text-pink-200 font-bold text-sm animate-glow">
                                    <i class="fas fa-wand-sparkles mr-1"></i>
                                    Waiting...
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Quick Spell Guide - Single Row -->
                    <div class="mt-6 lg:mt-8 animate-fade-in">
                        <div class="glass rounded-2xl p-4">
                            <div class="flex items-center mb-3">
                                <i class="fas fa-book-sparkles text-pink-400 mr-2"></i>
                                <h3 class="text-lg font-bold text-white">Quick Spell Guide ‚ú®</h3>
                            </div>
                            <div class="grid grid-cols-6 gap-2">
                                <div class="glass rounded-xl p-2 text-center hover:scale-105 transition-transform duration-300">
                                    <div class="text-2xl mb-1 text-pink-400">‚úã</div>
                                    <div class="font-bold text-white text-xs mb-0.5">Open Palm</div>
                                    <div class="text-[10px] text-pink-200">Flowers</div>
                                </div>
                                <div class="glass rounded-xl p-2 text-center hover:scale-105 transition-transform duration-300">
                                    <div class="text-2xl mb-1 text-pink-400">‚úåÔ∏è</div>
                                    <div class="font-bold text-white text-xs mb-0.5">Peace</div>
                                    <div class="text-[10px] text-pink-200">Fireworks</div>
                                </div>
                                <div class="glass rounded-xl p-2 text-center hover:scale-105 transition-transform duration-300">
                                    <div class="text-2xl mb-1 text-pink-400">üëÜ</div>
                                    <div class="font-bold text-white text-xs mb-0.5">Pointing</div>
                                    <div class="text-[10px] text-pink-200">Sparkles</div>
                                </div>
                                <div class="glass rounded-xl p-2 text-center hover:scale-105 transition-transform duration-300">
                                    <div class="text-2xl mb-1 text-pink-400">ü§ò</div>
                                    <div class="font-bold text-white text-xs mb-0.5">Rock On</div>
                                    <div class="text-[10px] text-pink-200">Hearts</div>
                                </div>
                                <div class="glass rounded-xl p-2 text-center hover:scale-105 transition-transform duration-300">
                                    <div class="text-2xl mb-1 text-pink-400">‚úä</div>
                                    <div class="font-bold text-white text-xs mb-0.5">Fist</div>
                                    <div class="text-[10px] text-pink-200">Clear All</div>
                                </div>
                                <div class="glass rounded-xl p-2 text-center hover:scale-105 transition-transform duration-300">
                                    <div class="text-2xl mb-1 text-pink-400">üëç</div>
                                    <div class="font-bold text-white text-xs mb-0.5">Thumbs Up</div>
                                    <div class="text-[10px] text-pink-200">Confetti</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column - Magic Stats (1/4) -->
            <div class="lg:col-span-1">
                <div class="glass-dark rounded-3xl p-5 lg:p-6 h-full flex flex-col">
                    <div class="flex items-center mb-6">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-pink-400 to-pink-600 flex items-center justify-center mr-3 shadow-lg">
                            <i class="fas fa-chart-line text-white text-lg"></i>
                        </div>
                        <div>
                            <h2 class="text-xl lg:text-2xl font-bold text-white">Magic Stats</h2>
                            <p class="text-pink-200 text-sm">Real-time tracking data</p>
                        </div>
                    </div>

                    <!-- Stats Grid -->
                    <div class="space-y-4 mb-6 flex-1">
                        <!-- Current Gesture -->
                        <div class="glass rounded-2xl p-4 text-center animate-pulse-slow">
                            <div class="text-xs text-pink-200 mb-1 uppercase tracking-wider">Active Spell</div>
                            <div id="currentGesture" class="text-xl font-bold bg-gradient-to-r from-pink-300 via-pink-400 to-pink-500 bg-clip-text text-transparent">
                                <i class="fas fa-magic mr-1"></i>
                                Ready
                            </div>
                        </div>
                        
                        <!-- Stats Cards -->
                        <div class="glass rounded-2xl p-4">
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 rounded-full bg-pink-400/20 flex items-center justify-center mr-2">
                                    <i class="fas fa-hands text-pink-300"></i>
                                </div>
                                <div class="text-sm text-pink-200">Hands Detected</div>
                            </div>
                            <div id="handCount" class="text-3xl font-bold text-white text-center">0</div>
                        </div>
                        
                        <div class="glass rounded-2xl p-4">
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 rounded-full bg-pink-400/20 flex items-center justify-center mr-2">
                                    <i class="fas fa-star text-pink-300"></i>
                                </div>
                                <div class="text-sm text-pink-200">Confidence</div>
                            </div>
                            <div id="confidence" class="text-3xl font-bold text-white text-center">0%</div>
                        </div>
                        
                        <div class="glass rounded-2xl p-4">
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 rounded-full bg-pink-400/20 flex items-center justify-center mr-2">
                                    <i class="fas fa-bolt text-pink-300"></i>
                                </div>
                                <div class="text-sm text-pink-200">Processing</div>
                            </div>
                            <div id="processTime" class="text-3xl font-bold text-white text-center">0ms</div>
                        </div>
                        
                        <div class="glass rounded-2xl p-4">
                            <div class="flex items-center mb-2">
                                <div class="w-8 h-8 rounded-full bg-pink-400/20 flex items-center justify-center mr-2">
                                    <i class="fas fa-sparkles text-pink-300"></i>
                                </div>
                                <div class="text-sm text-pink-200">Active Effects</div>
                            </div>
                            <div id="effectCount" class="text-3xl font-bold text-white text-center">0</div>
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="glass rounded-2xl p-4">
                        <h3 class="text-lg font-semibold text-white mb-3 flex items-center">
                            <i class="fas fa-sliders-h mr-2"></i> Controls
                        </h3>
                        <div class="space-y-3">
                            <button onclick="toggleVisuals()" id="visualsBtn" 
                                    class="w-full bg-gradient-to-r from-pink-400 to-pink-600 hover:from-pink-500 hover:to-pink-400 text-white font-bold py-3 px-4 rounded-xl transition-all duration-300 hover:scale-[1.02] active:scale-95 shadow-lg">
                                <i class="fas fa-sparkles mr-2"></i>
                                <span class="effect-status">Effects: ON</span>
                            </button>
                            <button onclick="togglePerformanceMode()" id="performanceBtn" 
                                    class="w-full bg-gradient-to-r from-pink-300 to-pink-500 hover:from-pink-400 hover:to-pink-300 text-white font-bold py-3 px-4 rounded-xl transition-all duration-300 hover:scale-[1.02] active:scale-95 shadow-lg">
                                <i class="fas fa-bolt mr-2"></i>
                                <span class="performance-status">Turbo Mode</span>
                            </button>
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="calibrate()" 
                                        class="bg-gradient-to-r from-pink-200 to-pink-400 hover:from-pink-300 hover:to-pink-200 text-white font-bold py-2 px-3 rounded-xl transition-all duration-300 hover:scale-[1.02] active:scale-95 text-sm shadow">
                                    <i class="fas fa-sync-alt mr-1"></i>
                                    Calibrate
                                </button>
                                <button onclick="clearAllEffects()" 
                                        class="bg-gradient-to-r from-rose-400 to-rose-500 hover:from-rose-500 hover:to-rose-400 text-white font-bold py-2 px-3 rounded-xl transition-all duration-300 hover:scale-[1.02] active:scale-95 text-sm shadow">
                                    <i class="fas fa-broom mr-1"></i>
                                    Clear All
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

    <script>
        // ========== CONFIGURATION ==========
        const config = {
            width: 1280,
            height: 720,
            useMirror: true,
            highPerformance: true,
            showVisuals: true,
            modelComplexity: 0,
            detectionConfidence: 0.6,
            trackingConfidence: 0.5
        };

        // ========== ELEMENTS ==========
        const video = document.getElementById('videoInput');
        const canvas = document.getElementById('canvasOutput');
        const ctx = canvas.getContext('2d', { alpha: false });
        const fpsDisplay = document.getElementById('fps');
        const latencyDisplay = document.getElementById('latency');
        const gestureDisplay = document.getElementById('gestureDisplay');
        const currentGestureDisplay = document.getElementById('currentGesture');
        const handCountDisplay = document.getElementById('handCount');
        const confidenceDisplay = document.getElementById('confidence');
        const processTimeDisplay = document.getElementById('processTime');
        const effectCountDisplay = document.getElementById('effectCount');
        const visualEffectsContainer = document.getElementById('visualEffects');

        // ========== PERFORMANCE VARIABLES ==========
        let hands = null;
        let currentStream = null;
        let lastFrameTime = 0;
        let fps = 0;
        let frameCount = 0;
        let lastFpsUpdate = 0;
        let lastGesture = '';
        let isProcessing = false;
        let activeEffects = 0;
        let smoothedLandmarks = null;
        const smoothingFactor = 0.3;

        // ========== INITIALIZATION ==========
        async function init() {
            console.log('üå∏ Initializing Full-Screen Magic...');

            try {
                await startCamera();
                await initMediaPipe();
                startPerformanceMonitor();
                requestAnimationFrame(processLoop);
                console.log('‚ú® Magic System Ready!');
            } catch (error) {
                console.error('‚ùå Initialization failed:', error);
            }
        }

        // ========== CAMERA SETUP ==========
        async function startCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }

            const constraints = {
                video: {
                    width: { ideal: config.width },
                    height: { ideal: config.height },
                    frameRate: { ideal: 30 },
                    facingMode: 'user'
                }
            };

            try {
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = currentStream;
                
                await new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.play();
                        resolve();
                    };
                });
            } catch (error) {
                console.error('Camera error:', error);
            }
        }

        // ========== MEDIAPIPE SETUP ==========
        async function initMediaPipe() {
            hands = new self.Hands({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }
            });

            hands.setOptions({
                maxNumHands: 1,
                modelComplexity: config.modelComplexity,
                minDetectionConfidence: config.detectionConfidence,
                minTrackingConfidence: config.trackingConfidence,
                selfieMode: true
            });

            hands.onResults(onResults);
        }

        // ========== MAIN PROCESSING LOOP ==========
        function processLoop(timestamp) {
            const startTime = performance.now();

            if (!isProcessing && video.videoWidth > 0 && hands) {
                isProcessing = true;
                hands.send({ image: video })
                    .catch(error => console.error('Processing error:', error))
                    .finally(() => {
                        isProcessing = false;
                        const processTime = performance.now() - startTime;
                        processTimeDisplay.textContent = `${Math.round(processTime)}`;
                        latencyDisplay.textContent = Math.round(Date.now() - startTime);
                    });
            }

            updateFPS(timestamp);
            requestAnimationFrame(processLoop);
        }

        // ========== HANDLE RESULTS ==========
        function onResults(results) {
            const processStart = performance.now();

            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw video with pink overlay
            ctx.save();
            if (config.useMirror) {
                ctx.scale(-1, 1);
                ctx.translate(-canvas.width, 0);
            }
            
            // Draw video with pink tint
            ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);
            ctx.restore();

            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                smoothedLandmarks = smoothLandmarks(landmarks, smoothedLandmarks);

                // Draw hand with aesthetic pink theme
                drawHandAesthetic(smoothedLandmarks);

                // Detect gesture
                const gesture = detectGesture(smoothedLandmarks);
                updateGestureDisplay(gesture);

                // Update stats
                handCountDisplay.textContent = results.multiHandLandmarks.length;
                
                if (results.multiHandedness && results.multiHandedness[0]) {
                    const confidence = results.multiHandedness[0].score * 100;
                    confidenceDisplay.textContent = `${Math.round(confidence)}`;
                }

                // Create full-screen visual effects
                if (config.showVisuals && gesture !== lastGesture) {
                    createFullScreenEffect(gesture, landmarks);
                    lastGesture = gesture;
                }

                // Update effect count
                effectCountDisplay.textContent = activeEffects;

            } else {
                handCountDisplay.textContent = '0';
                confidenceDisplay.textContent = '0';
                gestureDisplay.innerHTML = '<i class="fas fa-hand-wave mr-1"></i>Wave your hand!';
                currentGestureDisplay.innerHTML = '<i class="fas fa-wand-sparkles mr-1"></i>Ready';
                lastGesture = '';
            }

            const totalTime = performance.now() - processStart;
            processTimeDisplay.textContent = `${Math.round(totalTime)}`;
        }

        // ========== SMOOTHING ==========
        function smoothLandmarks(newLandmarks, previousLandmarks) {
            if (!previousLandmarks) return newLandmarks;

            const smoothed = [];
            for (let i = 0; i < newLandmarks.length; i++) {
                const newPoint = newLandmarks[i];
                const prevPoint = previousLandmarks[i];

                smoothed.push({
                    x: prevPoint.x * (1 - smoothingFactor) + newPoint.x * smoothingFactor,
                    y: prevPoint.y * (1 - smoothingFactor) + newPoint.y * smoothingFactor,
                    z: prevPoint.z * (1 - smoothingFactor) + newPoint.z * smoothingFactor
                });
            }

            return smoothed;
        }

        // ========== AESTHETIC HAND DRAWING ==========
        function drawHandAesthetic(landmarks) {
            // Draw connections with soft pink gradient
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, '#FF6B9D');
            gradient.addColorStop(0.5, '#FF9EBD');
            gradient.addColorStop(1, '#FFC2D6');

            ctx.strokeStyle = gradient;
            ctx.lineWidth = 6;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.shadowColor = 'rgba(255, 107, 157, 0.5)';
            ctx.shadowBlur = 15;

            // Draw finger connections
            const fingerConnections = [
                [0, 1, 2, 3, 4],      // Thumb
                [0, 5, 6, 7, 8],      // Index
                [0, 9, 10, 11, 12],   // Middle
                [0, 13, 14, 15, 16],  // Ring
                [0, 17, 18, 19, 20]   // Pinky
            ];

            fingerConnections.forEach(finger => {
                ctx.beginPath();
                finger.forEach((pointIndex, i) => {
                    const point = landmarks[pointIndex];
                    let x = point.x * canvas.width;
                    let y = point.y * canvas.height;

                    if (config.useMirror) {
                        x = canvas.width - x;
                    }

                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                });
                ctx.stroke();
            });

            ctx.shadowBlur = 0;

            // Draw landmarks as glowing dots
            landmarks.forEach((point, index) => {
                let x = point.x * canvas.width;
                let y = point.y * canvas.height;

                if (config.useMirror) {
                    x = canvas.width - x;
                }

                const radius = index === 0 ? 10 : 6;

                // Outer glow
                ctx.beginPath();
                ctx.arc(x, y, radius + 4, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 107, 157, 0.3)';
                ctx.fill();

                // Inner dot
                ctx.beginPath();
                ctx.arc(x, y, radius, 0, Math.PI * 2);
                const innerGradient = ctx.createRadialGradient(x, y, 0, x, y, radius);
                innerGradient.addColorStop(0, '#FFFFFF');
                innerGradient.addColorStop(0.5, '#FF9EBD');
                innerGradient.addColorStop(1, '#FF6B9D');
                ctx.fillStyle = innerGradient;
                ctx.fill();

                // Sparkle highlight
                ctx.beginPath();
                ctx.arc(x - radius/3, y - radius/3, radius/4, 0, Math.PI * 2);
                ctx.fillStyle = 'white';
                ctx.fill();
            });

            // Draw hand center with magical effect
            const center = landmarks[0];
            let centerX = center.x * canvas.width;
            let centerY = center.y * canvas.height;

            if (config.useMirror) {
                centerX = canvas.width - centerX;
            }

            // Pulsing magical circle
            const pulseSize = 25 + Math.sin(Date.now() * 0.003) * 8;

            ctx.beginPath();
            ctx.arc(centerX, centerY, pulseSize, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
            ctx.lineWidth = 2;
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(centerX, centerY, pulseSize - 5, 0, Math.PI * 2);
            ctx.strokeStyle = 'rgba(255, 107, 157, 0.8)';
            ctx.lineWidth = 1;
            ctx.stroke();
        }

        // ========== GESTURE DETECTION ==========
        function detectGesture(landmarks) {
            const tips = [4, 8, 12, 16, 20];
            const bases = [2, 5, 9, 13, 17];

            const fingerStates = tips.map((tipIdx, i) => {
                const tip = landmarks[tipIdx];
                const base = landmarks[bases[i]];
                return tip.y < base.y;
            });

            const [thumbUp, indexUp, middleUp, ringUp, pinkyUp] = fingerStates;

            if (indexUp && middleUp && !ringUp && !pinkyUp) {
                return "‚úåÔ∏è Peace Sign";
            } else if (indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "üëÜ Pointing";
            } else if (!indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "‚úä Fist";
            } else if (indexUp && middleUp && ringUp && pinkyUp) {
                return "‚úã Open Palm";
            } else if (indexUp && !middleUp && !ringUp && pinkyUp) {
                return "ü§ò Rock On";
            } else if (thumbUp && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "üëç Thumbs Up";
            } else {
                return "üå∏ Detecting...";
            }
        }

        // ========== EPIC FULL-SCREEN VISUAL EFFECTS ==========
        function createFullScreenEffect(gesture, landmarks) {
            if (!config.showVisuals) return;

            const center = landmarks[0];
            const x = (config.useMirror ? (1 - center.x) : center.x) * window.innerWidth;
            const y = center.y * window.innerHeight;

            switch (gesture) {
                case "‚úåÔ∏è Peace Sign":
                    createFireworks(x, y);
                    break;
                case "üëÜ Pointing":
                    createSparkleTrail(x, y);
                    break;
                case "‚úä Fist":
                    clearAllEffects();
                    break;
                case "‚úã Open Palm":
                    createFlowerBloom(x, y);
                    break;
                case "ü§ò Rock On":
                    createHeartExplosion(x, y);
                    break;
                case "üëç Thumbs Up":
                    createConfettiShower(x, y);
                    break;
            }
        }

        // ========== EFFECT FUNCTIONS ==========
        function createFireworks(x, y) {
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = `${Math.random() * window.innerWidth}px`;
                    firework.style.top = `${window.innerHeight}px`;
                    
                    const colors = ['#FF6B9D', '#FF9EBD', '#FFC2D6', '#FF85AB', '#FF5294'];
                    const color = colors[Math.floor(Math.random() * colors.length)];
                    
                    visualEffectsContainer.appendChild(firework);
                    activeEffects++;

                    setTimeout(() => {
                        for (let j = 0; j < 20; j++) {
                            const particle = document.createElement('div');
                            particle.className = 'effect-circle';
                            particle.style.left = firework.style.left;
                            particle.style.top = firework.style.top;
                            particle.style.width = '12px';
                            particle.style.height = '12px';
                            particle.style.background = `radial-gradient(circle, ${color} 0%, ${color}00 70%)`;
                            
                            const angle = Math.random() * Math.PI * 2;
                            const distance = 150 + Math.random() * 250;
                            
                            visualEffectsContainer.appendChild(particle);
                            activeEffects++;

                            particle.animate([
                                { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                                { transform: `translate(${Math.cos(angle) * distance}px, ${Math.sin(angle) * distance}px) scale(0)`, opacity: 0 }
                            ], {
                                duration: 1800,
                                easing: 'ease-out'
                            });

                            setTimeout(() => {
                                if (particle.parentNode) {
                                    particle.remove();
                                    activeEffects--;
                                }
                            }, 1800);
                        }
                        if (firework.parentNode) {
                            firework.remove();
                            activeEffects--;
                        }
                    }, 800);
                }, i * 150);
            }
        }

        function createSparkleTrail(x, y) {
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const sparkle = document.createElement('div');
                    sparkle.className = 'sparkle';
                    sparkle.style.left = `${x + Math.random() * 100 - 50}px`;
                    sparkle.style.top = `${y + Math.random() * 100 - 50}px`;
                    sparkle.style.width = '25px';
                    sparkle.style.height = '25px';
                    sparkle.style.background = 'radial-gradient(circle, #FFFFFF 0%, #FF6B9D 100%)';
                    sparkle.style.borderRadius = '50%';
                    sparkle.style.boxShadow = '0 0 20px #FFFFFF';

                    visualEffectsContainer.appendChild(sparkle);
                    activeEffects++;

                    setTimeout(() => {
                        if (sparkle.parentNode) {
                            sparkle.remove();
                            activeEffects--;
                        }
                    }, 2000);
                }, i * 40);
            }
        }

        function createFlowerBloom(x, y) {
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const flower = document.createElement('div');
                    flower.className = 'effect-circle';
                    flower.style.left = `${x}px`;
                    flower.style.top = `${y}px`;
                    flower.style.width = '200px';
                    flower.style.height = '200px';
                    flower.style.background = `radial-gradient(circle, #FF6B9D 0%, #FFC2D6 50%, transparent 70%)`;
                    
                    visualEffectsContainer.appendChild(flower);
                    activeEffects++;

                    setTimeout(() => {
                        if (flower.parentNode) {
                            flower.remove();
                            activeEffects--;
                        }
                    }, 2000);
                }, i * 300);
            }
        }

        function createHeartExplosion(x, y) {
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.innerHTML = 'üíñ';
                    heart.style.fontSize = '2rem';
                    heart.style.left = `${x}px`;
                    heart.style.top = `${y}px`;
                    
                    visualEffectsContainer.appendChild(heart);
                    activeEffects++;

                    const angle = Math.random() * Math.PI * 2;
                    const distance = 200 + Math.random() * 300;
                    
                    setTimeout(() => {
                        if (heart.parentNode) {
                            heart.remove();
                            activeEffects--;
                        }
                    }, 2000);
                }, i * 60);
            }
        }

        function createConfettiShower(x, y) {
            for (let i = 0; i < 60; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * window.innerWidth}px`;
                confetti.style.top = `-20px`;
                
                const colors = ['#FF6B9D', '#FF9EBD', '#FFC2D6', '#FFFFFF', '#FFE1EB'];
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                
                visualEffectsContainer.appendChild(confetti);
                activeEffects++;

                setTimeout(() => {
                    if (confetti.parentNode) {
                        confetti.remove();
                        activeEffects--;
                    }
                }, 3500);
            }
        }

        function clearAllEffects() {
            visualEffectsContainer.innerHTML = '';
            activeEffects = 0;
            effectCountDisplay.textContent = '0';
        }

        // ========== UI CONTROLS ==========
        function toggleVisuals() {
            config.showVisuals = !config.showVisuals;
            const btn = document.querySelector('.effect-status');
            btn.textContent = `Effects: ${config.showVisuals ? 'ON' : 'OFF'}`;
            
            if (!config.showVisuals) {
                clearAllEffects();
            }
        }

        function togglePerformanceMode() {
            config.highPerformance = !config.highPerformance;
            config.modelComplexity = config.highPerformance ? 0 : 1;
            const btn = document.querySelector('.performance-status');
            btn.textContent = config.highPerformance ? 'Turbo: ON' : 'Turbo: OFF';
            initMediaPipe();
        }

        function calibrate() {
            smoothedLandmarks = null;
            currentGestureDisplay.innerHTML = '<i class="fas fa-cog animate-spin mr-1"></i>Calibrating...';
            
            setTimeout(() => {
                currentGestureDisplay.innerHTML = '<i class="fas fa-check-circle mr-1"></i>Calibrated!';
                setTimeout(() => {
                    currentGestureDisplay.innerHTML = '<i class="fas fa-wand-sparkles mr-1"></i>Ready';
                }, 1000);
            }, 1000);
        }

        // ========== FPS MONITORING ==========
        function updateFPS(timestamp) {
            frameCount++;

            if (timestamp >= lastFpsUpdate + 1000) {
                fps = Math.round((frameCount * 1000) / (timestamp - lastFpsUpdate));
                fpsDisplay.textContent = fps;
                frameCount = 0;
                lastFpsUpdate = timestamp;
            }

            lastFrameTime = timestamp;
        }

        function startPerformanceMonitor() {
            setInterval(() => {
                if (performance.memory) {
                    const memoryMB = performance.memory.usedJSHeapSize / 1048576;
                    if (memoryMB > 150) {
                        console.warn(`High memory usage: ${memoryMB.toFixed(1)}MB`);
                    }
                }
            }, 5000);
        }

        function updateGestureDisplay(gesture) {
            gestureDisplay.innerHTML = `<i class="fas fa-magic mr-1"></i>${gesture}`;
            currentGestureDisplay.innerHTML = `<i class="fas fa-magic mr-1"></i>${gesture}`;
            
            const colors = {
                "‚úåÔ∏è Peace Sign": 'from-pink-400 to-pink-600',
                "üëÜ Pointing": 'from-pink-300 to-pink-500',
                "‚úä Fist": 'from-pink-500 to-pink-300',
                "‚úã Open Palm": 'from-pink-350 to-pink-550',
                "ü§ò Rock On": 'from-pink-550 to-pink-450',
                "üëç Thumbs Up": 'from-pink-450 to-pink-350'
            };

            currentGestureDisplay.className = `text-xl font-bold bg-gradient-to-r ${colors[gesture] || 'from-pink-300 to-pink-500'} bg-clip-text text-transparent`;
        }

        // ========== START APPLICATION ==========
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>