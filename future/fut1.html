<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hand Gesture Detector</title>
    <meta name="description" content="Detect hand gestures using computer vision.">
    <meta name="keywords" content="hand gesture, computer vision, webcam, gesture detection">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(45deg, #0f0c29, #302b63, #24243e);
            color: white;
            min-height: 100vh;
            padding: 20px;
            overflow: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }
        
        h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #00ff88, #00ffff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .subtitle {
            color: #aaa;
            font-size: 1em;
        }
        
        .main-content {
            flex: 1;
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            min-height: 0;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }
        
        .camera-container {
            flex: 3;
            position: relative;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 10px;
            border: 2px solid #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            overflow: hidden;
        }
        
        .camera-container h2 {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 10;
            color: #00ff88;
            background: rgba(0, 0, 0, 0.7);
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        #videoInput {
            display: none;
        }
        
        #canvasOutput {
            width: 100%;
            height: 100%;
            border-radius: 10px;
            background: black;
            display: block;
            transform: scaleX(-1);
        }
        
        .stats-panel {
            flex: 1;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #00ffff;
            display: flex;
            flex-direction: column;
            min-width: 300px;
        }
        
        .stats-panel h2 {
            color: #00ffff;
            margin-bottom: 15px;
            font-size: 1.5em;
        }
        
        .stat-item {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .stat-label {
            color: #aaa;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00ff88;
        }
        
        #gestureDisplay {
            font-size: 1.8em;
            text-align: center;
            padding: 15px;
            background: rgba(0, 255, 136, 0.1);
            border-radius: 10px;
            margin-top: 10px;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
            justify-content: center;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: black;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }
        
        button.secondary {
            background: linear-gradient(45deg, #00ffff, #0099cc);
        }
        
        button.danger {
            background: linear-gradient(45deg, #ff3366, #cc0044);
        }
        
        .fps-meter {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 12px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9em;
            border: 1px solid #00ff88;
            z-index: 100;
        }
        
        .visual-effects {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
            overflow: visible;
        }
        
        .effect-circle {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(0,255,136,0.8) 0%, rgba(0,255,136,0) 70%);
            animation: pulse 0.5s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes pulse {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }
        
        .tutorial {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            flex-shrink: 0;
        }
        
        .tutorial h3 {
            color: #00ffff;
            margin-bottom: 10px;
            font-size: 1.2em;
        }
        
        .gesture-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .gesture-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-size: 0.9em;
        }
        
        .gesture-icon {
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .gesture-name {
            color: #00ff88;
            font-weight: bold;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="fps-meter">
        FPS: <span id="fps">0</span> | 
        Latency: <span id="latency">0</span>ms
    </div>
    
    <div class="container">
        <header>
            <h1>‚ö° HAND GESTURE TURBO</h1>
            <p class="subtitle">Real-time gesture detection with visual effects</p>
        </header>
        
        <div class="main-content">
            <div class="camera-container">
                <h2>üé• Hand Tracking</h2>
                <video id="videoInput" autoplay playsinline muted></video>
                <canvas id="canvasOutput" width="640" height="480"></canvas>
            </div>
            
            <div class="stats-panel">
                <h2>üìä Tracking Stats</h2>
                
                <div class="stat-item">
                    <div class="stat-label">Current Gesture</div>
                    <div id="gestureDisplay">Waiting for hand...</div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px;">
                    <div class="stat-item">
                        <div class="stat-label">Hands Detected</div>
                        <div class="stat-value" id="handCount">0</div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-label">Confidence</div>
                        <div class="stat-value" id="confidence">0%</div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-label">Processing Time</div>
                        <div class="stat-value" id="processTime">0ms</div>
                    </div>
                    
                    <div class="stat-item">
                        <div class="stat-label">FPS</div>
                        <div class="stat-value" id="fpsStat">0</div>
                    </div>
                </div>
                
                <div class="controls">
                    <button onclick="togglePerformanceMode()" id="performanceBtn">
                        ‚ö° Performance: ON
                    </button>
                    <button onclick="toggleVisuals()" id="visualsBtn" class="secondary">
                        ‚ú® Effects: ON
                    </button>
                    <button onclick="calibrate()" class="secondary">
                        üéØ Calibrate
                    </button>
                </div>
            </div>
        </div>
        
        <div class="tutorial">
            <h3>üéÆ Quick Gesture Guide</h3>
            <div class="gesture-list">
                <div class="gesture-item">
                    <div class="gesture-icon">‚úåÔ∏è</div>
                    <div class="gesture-name">Peace Sign</div>
                    <div>Blue particles</div>
                </div>
                <div class="gesture-item">
                    <div class="gesture-icon">üëÜ</div>
                    <div class="gesture-name">Pointing</div>
                    <div>Red laser beam</div>
                </div>
                <div class="gesture-item">
                    <div class="gesture-icon">‚úä</div>
                    <div class="gesture-name">Fist</div>
                    <div>Yellow effect</div>
                </div>
                <div class="gesture-item">
                    <div class="gesture-icon">‚úã</div>
                    <div class="gesture-name">Open Hand</div>
                    <div>Explosion effect</div>
                </div>
                <div class="gesture-item">
                    <div class="gesture-icon">ü§ò</div>
                    <div class="gesture-name">Rock On</div>
                    <div>Purple lightning</div>
                </div>
                <div class="gesture-item">
                    <div class="gesture-icon">üëç</div>
                    <div class="gesture-name">Thumbs Up</div>
                    <div>Green stars</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Visual effects container -->
    <div class="visual-effects" id="visualEffects"></div>

    <!-- Load MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    
    <script>
        // ========== CONFIGURATION ==========
        const config = {
            width: 640,
            height: 480,
            useMirror: true,
            highPerformance: true,
            showVisuals: true,
            modelComplexity: 0,
            detectionConfidence: 0.6,
            trackingConfidence: 0.5
        };

        // ========== ELEMENTS ==========
        const video = document.getElementById('videoInput');
        const canvas = document.getElementById('canvasOutput');
        const ctx = canvas.getContext('2d');
        const fpsDisplay = document.getElementById('fps');
        const fpsStat = document.getElementById('fpsStat');
        const latencyDisplay = document.getElementById('latency');
        const gestureDisplay = document.getElementById('gestureDisplay');
        const handCountDisplay = document.getElementById('handCount');
        const confidenceDisplay = document.getElementById('confidence');
        const processTimeDisplay = document.getElementById('processTime');
        const visualEffectsContainer = document.getElementById('visualEffects');

        // ========== STATE VARIABLES ==========
        let hands = null;
        let currentStream = null;
        let lastFrameTime = 0;
        let fps = 0;
        let frameCount = 0;
        let lastFpsUpdate = 0;
        let lastGesture = '';
        let isProcessing = false;
        let smoothedLandmarks = null;
        const smoothingFactor = 0.3;

        // ========== INITIALIZE ==========
        async function init() {
            console.log('üöÄ Initializing hand tracking...');
            
            try {
                await startCamera();
                await initMediaPipe();
                requestAnimationFrame(processLoop);
                console.log('‚úÖ System ready!');
            } catch (error) {
                console.error('‚ùå Initialization failed:', error);
            }
        }

        // ========== CAMERA ==========
        async function startCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }
            
            const constraints = {
                video: {
                    width: { ideal: config.width },
                    height: { ideal: config.height },
                    frameRate: { ideal: 30 },
                    facingMode: 'user'
                }
            };
            
            try {
                currentStream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = currentStream;
                
                await new Promise((resolve) => {
                    video.onloadedmetadata = () => {
                        video.play();
                        resolve();
                    };
                });
                
            } catch (error) {
                console.error('Camera error:', error);
            }
        }

        // ========== MEDIAPIPE ==========
        async function initMediaPipe() {
            console.log('Loading MediaPipe...');
            
            hands = new self.Hands({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }
            });
            
            hands.setOptions({
                maxNumHands: 1,
                modelComplexity: config.modelComplexity,
                minDetectionConfidence: config.detectionConfidence,
                minTrackingConfidence: config.trackingConfidence,
                selfieMode: true
            });
            
            hands.onResults(onResults);
        }

        // ========== PROCESSING LOOP ==========
        function processLoop(timestamp) {
            const startTime = performance.now();
            
            if (!isProcessing && video.videoWidth > 0 && hands) {
                isProcessing = true;
                
                hands.send({ image: video })
                    .catch(error => console.error('Processing error:', error))
                    .finally(() => {
                        isProcessing = false;
                        
                        const processTime = performance.now() - startTime;
                        processTimeDisplay.textContent = `${Math.round(processTime)}ms`;
                        
                        const latency = Date.now() - startTime;
                        latencyDisplay.textContent = Math.round(latency);
                    });
            }
            
            updateFPS(timestamp);
            requestAnimationFrame(processLoop);
        }

        // ========== HANDLE RESULTS ==========
        function onResults(results) {
            const processStart = performance.now();
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw video (mirrored)
            ctx.save();
            if (config.useMirror) {
                ctx.scale(-1, 1);
                ctx.translate(-canvas.width, 0);
            }
            ctx.drawImage(results.image, 0, 0, canvas.width, canvas.height);
            ctx.restore();
            
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                const landmarks = results.multiHandLandmarks[0];
                
                // Apply smoothing
                smoothedLandmarks = smoothLandmarks(landmarks, smoothedLandmarks);
                
                // Draw hand with green dots
                drawHandWithGreenDots(smoothedLandmarks);
                
                // Detect gesture
                const gesture = detectGesture(smoothedLandmarks);
                
                // Update display
                updateGestureDisplay(gesture);
                
                // Update stats
                handCountDisplay.textContent = results.multiHandLandmarks.length;
                
                if (results.multiHandedness && results.multiHandedness[0]) {
                    const confidence = results.multiHandedness[0].score * 100;
                    confidenceDisplay.textContent = `${Math.round(confidence)}%`;
                }
                
                // Create visual effects
                if (config.showVisuals) {
                    createVisualEffect(gesture, smoothedLandmarks);
                }
                
            } else {
                // No hands detected
                handCountDisplay.textContent = '0';
                confidenceDisplay.textContent = '0%';
                gestureDisplay.textContent = 'üëã Show your hand!';
                gestureDisplay.style.background = 'rgba(255, 100, 100, 0.1)';
                lastGesture = '';
            }
            
            const totalTime = performance.now() - processStart;
            processTimeDisplay.textContent = `${Math.round(totalTime)}ms`;
        }

        // ========== SMOOTHING ==========
        function smoothLandmarks(newLandmarks, previousLandmarks) {
            if (!previousLandmarks) return newLandmarks;
            
            const smoothed = [];
            for (let i = 0; i < newLandmarks.length; i++) {
                const newPoint = newLandmarks[i];
                const prevPoint = previousLandmarks[i];
                
                smoothed.push({
                    x: prevPoint.x * (1 - smoothingFactor) + newPoint.x * smoothingFactor,
                    y: prevPoint.y * (1 - smoothingFactor) + newPoint.y * smoothingFactor,
                    z: prevPoint.z * (1 - smoothingFactor) + newPoint.z * smoothingFactor
                });
            }
            
            return smoothed;
        }

        // ========== DRAW HAND WITH GREEN DOTS ==========
        function drawHandWithGreenDots(landmarks) {
            // Draw connections
            const connections = self.Hands.HAND_CONNECTIONS;
            
            ctx.strokeStyle = '#00ff88';
            ctx.lineWidth = 2;
            
            connections.forEach(([start, end]) => {
                const startPoint = landmarks[start];
                const endPoint = landmarks[end];
                
                let startX = startPoint.x * canvas.width;
                let startY = startPoint.y * canvas.height;
                let endX = endPoint.x * canvas.width;
                let endY = endPoint.y * canvas.height;
                
                if (config.useMirror) {
                    startX = canvas.width - startX;
                    endX = canvas.width - endX;
                }
                
                ctx.beginPath();
                ctx.moveTo(startX, startY);
                ctx.lineTo(endX, endY);
                ctx.stroke();
            });
            
            // Draw green dots for landmarks
            landmarks.forEach((point, index) => {
                let x = point.x * canvas.width;
                let y = point.y * canvas.height;
                
                if (config.useMirror) {
                    x = canvas.width - x;
                }
                
                // Draw green dot
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                
                // Different colors for different points
                if (index === 0) {
                    ctx.fillStyle = '#ff0000'; // Palm base in red
                } else if (index === 4 || index === 8 || index === 12 || index === 16 || index === 20) {
                    ctx.fillStyle = '#ffff00'; // Finger tips in yellow
                } else {
                    ctx.fillStyle = '#00ff00'; // Other points in green
                }
                
                ctx.fill();
                
                // Add glow effect
                ctx.beginPath();
                ctx.arc(x, y, 6, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(0, 255, 0, 0.3)';
                ctx.fill();
            });
        }

        // ========== GESTURE DETECTION ==========
        function detectGesture(landmarks) {
            const tips = [4, 8, 12, 16, 20];
            const bases = [2, 5, 9, 13, 17];
            
            const fingerStates = tips.map((tipIdx, i) => {
                const tip = landmarks[tipIdx];
                const base = landmarks[bases[i]];
                return tip.y < base.y;
            });
            
            const [thumbUp, indexUp, middleUp, ringUp, pinkyUp] = fingerStates;
            
            if (indexUp && middleUp && !ringUp && !pinkyUp) {
                return "‚úåÔ∏è Peace Sign";
            } else if (indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "üëÜ Pointing";
            } else if (!indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "‚úä Fist";
            } else if (indexUp && middleUp && ringUp && pinkyUp) {
                return "‚úã Open Hand";
            } else if (indexUp && !middleUp && !ringUp && pinkyUp) {
                return "ü§ò Rock On";
            } else if (thumbUp && !indexUp && !middleUp && !ringUp && !pinkyUp) {
                return "üëç Thumbs Up";
            } else {
                return "‚úã Hand Detected";
            }
        }

        // ========== VISUAL EFFECTS ==========
        function createVisualEffect(gesture, landmarks) {
            if (!config.showVisuals || gesture === lastGesture) return;
            
            lastGesture = gesture;
            
            // Get hand center position - use wrist point (index 0)
            const center = landmarks[0];
            
            // Calculate position relative to CANVAS, not window
            // Canvas coordinates are already mirrored in drawing
            let canvasX = center.x * canvas.width;
            let canvasY = center.y * canvas.height;
            
            // Get canvas position on page
            const canvasRect = canvas.getBoundingClientRect();
            
            // Convert to screen coordinates
            const screenX = canvasRect.left + (config.useMirror ? (canvas.width - canvasX) : canvasX);
            const screenY = canvasRect.top + canvasY;
            
            // Create effect based on gesture
            switch(gesture) {
                case "‚úåÔ∏è Peace Sign":
                    createParticles(screenX, screenY, '#00ffff', 15);
                    break;
                case "üëÜ Pointing":
                    createLaserBeam(screenX, screenY);
                    break;
                case "‚úä Fist":
                    createExplosion(screenX, screenY, '#ffcc00');
                    break;
                case "‚úã Open Hand":
                    createParticles(screenX, screenY, '#00ff88', 25);
                    break;
                case "ü§ò Rock On":
                    createLightning(screenX, screenY);
                    break;
                case "üëç Thumbs Up":
                    createStars(screenX, screenY);
                    break;
            }
            
            // Always create a circle effect
            createCircleEffect(screenX, screenY);
        }

        function createCircleEffect(x, y) {
            const circle = document.createElement('div');
            circle.className = 'effect-circle';
            circle.style.left = `${x}px`;
            circle.style.top = `${y}px`;
            circle.style.width = '60px';
            circle.style.height = '60px';
            circle.style.background = 'radial-gradient(circle, rgba(0,255,136,0.8) 0%, rgba(0,255,136,0) 70%)';
            
            visualEffectsContainer.appendChild(circle);
            
            setTimeout(() => {
                if (circle.parentNode) {
                    circle.remove();
                }
            }, 500);
        }

        function createParticles(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.style.cssText = `
                        position: absolute;
                        left: ${x}px;
                        top: ${y}px;
                        width: 15px;
                        height: 15px;
                        background: radial-gradient(circle, ${color} 0%, ${color}00 70%);
                        border-radius: 50%;
                        pointer-events: none;
                        transform: translate(-50%, -50%);
                        z-index: 1000;
                    `;
                    
                    visualEffectsContainer.appendChild(particle);
                    
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 50 + Math.random() * 100;
                    const targetX = Math.cos(angle) * distance;
                    const targetY = Math.sin(angle) * distance;
                    
                    particle.animate([
                        { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 },
                        { transform: `translate(calc(-50% + ${targetX}px), calc(-50% + ${targetY}px)) scale(0)`, opacity: 0 }
                    ], {
                        duration: 800,
                        easing: 'ease-out'
                    });
                    
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.remove();
                        }
                    }, 800);
                }, i * 30);
            }
        }

        function createLaserBeam(x, y) {
            const beam = document.createElement('div');
            beam.style.cssText = `
                position: absolute;
                left: ${x}px;
                top: ${y}px;
                width: 150px;
                height: 4px;
                background: linear-gradient(90deg, #ff3366, #ff336600);
                transform-origin: 0 0;
                pointer-events: none;
                z-index: 1000;
                transform: translate(-50%, -50%);
            `;
            
            const angle = Math.random() * Math.PI * 2;
            beam.style.transform = `translate(-50%, -50%) rotate(${angle}rad)`;
            
            visualEffectsContainer.appendChild(beam);
            
            beam.animate([
                { transform: `translate(-50%, -50%) rotate(${angle}rad) scaleX(0)`, opacity: 1 },
                { transform: `translate(-50%, -50%) rotate(${angle}rad) scaleX(1)`, opacity: 0 }
            ], {
                duration: 400,
                easing: 'ease-out'
            });
            
            setTimeout(() => {
                if (beam.parentNode) {
                    beam.remove();
                }
            }, 400);
        }

        function createExplosion(x, y, color) {
            createParticles(x, y, color, 20);
        }

        function createLightning(x, y) {
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    const beam = document.createElement('div');
                    beam.style.cssText = `
                        position: absolute;
                        left: ${x}px;
                        top: ${y}px;
                        width: 120px;
                        height: 3px;
                        background: linear-gradient(90deg, #ff00ff, #ff00ff00);
                        transform-origin: 0 0;
                        pointer-events: none;
                        z-index: 1000;
                        transform: translate(-50%, -50%);
                    `;
                    
                    const angle = Math.random() * Math.PI * 2;
                    beam.style.transform = `translate(-50%, -50%) rotate(${angle}rad)`;
                    
                    visualEffectsContainer.appendChild(beam);
                    
                    beam.animate([
                        { transform: `translate(-50%, -50%) rotate(${angle}rad) scaleX(0)`, opacity: 1 },
                        { transform: `translate(-50%, -50%) rotate(${angle}rad) scaleX(1)`, opacity: 0 }
                    ], {
                        duration: 300,
                        easing: 'ease-out'
                    });
                    
                    setTimeout(() => {
                        if (beam.parentNode) {
                            beam.remove();
                        }
                    }, 300);
                }, i * 100);
            }
        }

        function createStars(x, y) {
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const star = document.createElement('div');
                    star.style.cssText = `
                        position: absolute;
                        left: ${x + Math.random() * 100 - 50}px;
                        top: ${y + Math.random() * 100 - 50}px;
                        width: 15px;
                        height: 15px;
                        background: radial-gradient(circle, #ffffff 0%, #00ff88 100%);
                        border-radius: 50%;
                        pointer-events: none;
                        z-index: 1000;
                        transform: translate(-50%, -50%);
                    `;
                    
                    visualEffectsContainer.appendChild(star);
                    
                    star.animate([
                        { transform: 'translate(-50%, -50%) scale(0)', opacity: 1 },
                        { transform: 'translate(-50%, -50%) scale(1.5)', opacity: 0 }
                    ], {
                        duration: 1000,
                        easing: 'ease-out'
                    });
                    
                    setTimeout(() => {
                        if (star.parentNode) {
                            star.remove();
                        }
                    }, 1000);
                }, i * 80);
            }
        }

        // ========== FPS COUNTER ==========
        function updateFPS(timestamp) {
            frameCount++;
            
            if (timestamp >= lastFpsUpdate + 1000) {
                fps = Math.round((frameCount * 1000) / (timestamp - lastFpsUpdate));
                fpsDisplay.textContent = fps;
                fpsStat.textContent = fps;
                frameCount = 0;
                lastFpsUpdate = timestamp;
            }
        }

        function updateGestureDisplay(gesture) {
            gestureDisplay.textContent = gesture;
            
            const colors = {
                "‚úåÔ∏è Peace Sign": 'rgba(0, 255, 255, 0.2)',
                "üëÜ Pointing": 'rgba(255, 51, 102, 0.2)',
                "‚úä Fist": 'rgba(255, 204, 0, 0.2)',
                "‚úã Open Hand": 'rgba(0, 255, 136, 0.2)',
                "ü§ò Rock On": 'rgba(255, 0, 255, 0.2)',
                "üëç Thumbs Up": 'rgba(0, 255, 136, 0.2)',
                "‚úã Hand Detected": 'rgba(255, 255, 255, 0.1)'
            };
            
            gestureDisplay.style.background = colors[gesture] || 'rgba(255, 255, 255, 0.1)';
            
            gestureDisplay.style.transform = 'scale(1.05)';
            setTimeout(() => {
                gestureDisplay.style.transform = 'scale(1)';
            }, 100);
        }

        // ========== UI CONTROLS ==========
        function togglePerformanceMode() {
            config.highPerformance = !config.highPerformance;
            config.modelComplexity = config.highPerformance ? 0 : 1;
            
            const btn = document.getElementById('performanceBtn');
            btn.textContent = `‚ö° Performance: ${config.highPerformance ? 'ON' : 'OFF'}`;
            
            initMediaPipe();
        }

        function toggleVisuals() {
            config.showVisuals = !config.showVisuals;
            const btn = document.getElementById('visualsBtn');
            btn.textContent = `‚ú® Effects: ${config.showVisuals ? 'ON' : 'OFF'}`;
            
            if (!config.showVisuals) {
                visualEffectsContainer.innerHTML = '';
            }
        }

        function calibrate() {
            smoothedLandmarks = null;
            gestureDisplay.textContent = 'üéØ Calibrating...';
            gestureDisplay.style.background = 'rgba(255, 204, 0, 0.3)';
            
            setTimeout(() => {
                gestureDisplay.textContent = '‚úÖ Calibrated!';
                setTimeout(() => {
                    gestureDisplay.textContent = 'üëã Show your hand!';
                }, 1000);
            }, 1000);
        }

        // ========== START ==========
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>